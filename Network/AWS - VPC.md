### VPC와 아이피 대역

VPC는 기본적으로 가상의 네트워크 영역이기 때문에 **사설 아이피 주소**를 가지게 된다.
사설 아이피 대역은 `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/24` 이렇게 3개의 대역을 가지며, 하나의 VPC에는 위의 네트워크 대역, 혹은 서브넷 대역이 할당 가능하다.
- 예시로, `10.0.0.0/8`의 서브넷인 `10.0.0.0/16`도 VPC에 할당 가능하다!

<br>

### VPC의 실제 사용

VPC는 실제로 사용 시 VPC 자체에서도 서브넷을 나눠서 사용하게 된다. (단, VPC를 나눈 서브넷을 다시 나누지는 못한다!)
- 예시로, `10.0.0.0/16`의 아이피 주소를 VPC에 할당한 상황에서, 다시 서브넷으로 나눠서 각각의 서브넷을 원하는 가용영역에 배치하여 사용하게 된다.

이때, 유의해야 할 점은 VPC의 서브넷 아이피 대역에서는 실제 네트워크와 달리, 총 5개의 아이피 주소를 호스트에 할당할 수 없다는 것이다.

1. 첫 번째: 서브넷의 네트워크 대역
2. 두 번째: **VPC 라우터에 할당**
3. 세 번째: Amazon에 제공하는 DNS에 할당
4. 미래를 위해 예약
5. 브로드캐스트 주소

위의 내용으로 <ins>**VPC 내부적으로 라우터가 있고, 따라서 VPC 내부 서브넷끼리 통신이 된다**</ins>는 것을 알 수 있다.

<br>

### VPC와 외부 통신

기본적으로 사설 아이피 대역은 공용 아이피 대역과 통신이 불가능하다. 그런데 AWS로 인프라를 구축하면 통신이 된다. 왜일까?

**서브넷이 외부와 통신할 때, 인터넷 게이트웨이를 거치게 하면** 외부와 통신이 가능하게 된다. 이렇게 VPC 서브넷 중 외부와 통신이 원활하게 되는 서브넷 대역을 public subnet이라 한다. **인터넷 게이트웨이를 통해 밖으로 나가도록 라우팅 테이블 설정을 해주면** 해당 서브넷을 public subnet으로 만들 수 있다.

<예시>

| Destination | Target |
| :--------------- | :--------------- |
| 0.0.0.0/0 | igw-id |
| 10.0.0.0/16 | Local |

-  `0.0.0.0/0`(모든 IP 주소 = 밖으로 나갈 때)이 목적지이면, 인터넷 게이트웨이로 나감
-  `10.0.0.0/16`(VPC 주소 = VPC로 들어올 때)이 목적지이면, 내부 VPC 라우터가 알아서 잘 보내줌

<br>

public subnet과 달리, private subnet은 아무런 조치를 취하지 않아 외부와 단절된 서브넷이다. 그렇다면 private subnet은 무슨 의미가 있을까?

  

먼저, 사설 아이피 대역의 존재 의의를 생각해보자. 부족한 아이피 주소 문제를 완화하는 것 외에도 사설 아이피를 사용하는 것은 **높은 보안성**이라는 이점이 있다. AWS VPC에서 사설 아이피는 이 보안성의 측면에서 이해하면 된다.
**릴리즈 서버의 경우**, 실제 고객의 데이터가 저장되는 데이터베이스를 보호해야 하므로, 데이터베이스를 private subnet에 배치하는 것이 필요하다.

그렇다면 아래의 2가지 의문점이 생길 수 있다.

1. private subnet에 두면 외부와 통신이 안 되는데, 그러면 데이터베이스를 못 쓰는 거 아닌가?
2. 데이터베이스에 원격으로 접속하고 싶은데 안 되나?

우선 1번의 경우는, **같은 VPC의 서브넷은 통신이 가능하기 때문에** 데이터베이스를 사용하는(DB에 데이터를 저장하려는) EC2 등과 같은 컴퓨팅 자원을 **같은 VPC에 배치하면 된다.**
2번의 경우는, private subnet과 같은 VPC에 존재하는 public subnet의 호스트의 도움을 받으면 된다. 이때, private subnet의 자원에 접속이 되도록 도와주는 호스트를 Bastion host라고 부른다.

<br>

### 참고

UMC Server 파트 워크북 - Chapter 2. AWS (VPC & Internet Gateway & EC2)
